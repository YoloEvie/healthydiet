import{A as N}from"./ArticleCard-CPeb8u_b.js";import{a as u}from"./axios-NIGUFBhG.js";import{_ as P,u as V}from"./index-bPO5O26h.js";import{r,c as M,v as T,k as i,e as h,o as s,f as g,y as m,x as p,g as U,j as F,l as L,F as R,A as j}from"./element-plus-BAXMo5c4.js";const q={class:"my-articles"},E={id:"header"},I={key:2,class:"article-flex"},O={__name:"MyPost",setup(S){const f=V();u.defaults.baseURL="http://localhost:3000";const n=r(""),v=r([]),_=r(null),c=r({}),l=r(!0),a=r(""),d=M(()=>v.value.filter(e=>e.type==="Ordinary")),y=async e=>{try{const t=await u.get(`/api/users/${e}`);_.value=t.data}catch(t){console.error("获取用户信息失败:",t),a.value="获取用户信息失败"}},k=async e=>{try{const t=await u.get(`/api/article-photos/article/${e}`);return t.data&&t.data.length>0?(c.value[e]=t.data[0].image_url,console.log(`文章 ${e} 照片:`,t.data[0].image_url),t.data[0].image_url):(c.value[e]=null,console.log(`文章 ${e} 没有照片`),null)}catch(t){return console.error(`获取文章 ${e} 照片失败:`,t),c.value[e]=null,null}},x=async()=>{try{l.value=!0,console.log("userId:",n.value),await y(n.value);const e=await u.get(`/api/articles/author/${n.value}`);v.value=e.data;for(const t of v.value)await k(t.article_id)}catch(e){e.response?a.value=e.response.data.message||`错误 ${e.response.status}: 获取文章失败`:e.request?a.value="无法连接到服务器，请检查后端服务是否运行":a.value="发生未知错误，请重试",console.error("获取用户文章错误:",e)}finally{l.value=!1}},$=e=>{console.log("查看文章详情:",e),f.push(`/article/${e}`)},C=()=>{f.back()};return T(()=>{const e=localStorage.getItem("user_id");if(console.log("userIdText:",e),!e){a.value="未找到用户信息，请先登录",l.value=!1;return}n.value=e.replace(/^["']|["']$/g,""),x()}),(e,t)=>{const w=i("el-button"),A=i("el-skeleton"),b=i("el-alert"),B=i("el-empty");return s(),h("div",q,[g("div",E,[U(w,{type:"primary",onClick:C},{default:F(()=>t[0]||(t[0]=[L(" 返回 ")])),_:1,__:[0]}),t[1]||(t[1]=g("h2",null,"我发布的帖子",-1))]),l.value?(s(),m(A,{key:0,class:"article-skeleton",count:3})):p("",!0),a.value?(s(),m(b,{key:1,type:"error",message:a.value,"show-icon":""},null,8,["message"])):p("",!0),d.value.length>0&&!l.value?(s(),h("div",I,[(s(!0),h(R,null,j(d.value,o=>(s(),m(N,{class:"article-card",key:o.article_id,"image-url":c.value[o.article_id]||"https://picsum.photos/400/200",title:o.title,excerpt:o.summary,"author-name":_.value?.username||"未知用户","author-avatar":_.value?.avatar_url||"https://picsum.photos/100/100",category:o.type,likes:o.likes_count,comments:o.comments_count,onClick:z=>$(o.article_id)},null,8,["image-url","title","excerpt","author-name","author-avatar","category","likes","comments","onClick"]))),128))])):p("",!0),d.value.length===0&&!l.value&&!a.value?(s(),m(B,{key:3,description:"暂无发布的普通文章"})):p("",!0)])}}},K=P(O,[["__scopeId","data-v-b9dcc066"]]);export{K as default};
