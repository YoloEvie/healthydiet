import{a as F,u as S,_ as W}from"./index-CMQRH6kX.js";import{d as q,r as g,c as N,t as G,G as y,e as $,f as s,x as d,g as m,j as c,l as n,u as D,N as O,k as v,y as u,v as z,O as P,E as H,B as J,F as K,z as Q,o as l}from"./element-plus-DirRqt2a.js";import{a as X}from"./axios-NIGUFBhG.js";const Y={class:"view-recipe-container"},Z={class:"page-header"},ee={class:"recipe-title"},te={class:"header-actions"},ae={class:"recipe-header"},se={class:"recipe-meta"},re={class:"status-container"},oe={class:"meta-info"},le={key:0},ie={class:"recipe-description"},ce={class:"article-grid"},ne={class:"article-item"},ue={class:"article-info"},de={class:"article-name"},pe={class:"article-date"},_e={class:"article-summary"},me=q({__name:"ViewCookBook",setup(ve){const V=F(),k=S(),w=g(!0),I=g(!1),E=g(!1);g({});const a=g({recipe_id:"",recipe_name:"",cover_image_url:"",description:"",status:"draft",created_at:"",created_by:"",ingredients:[],steps:[],articles:[]}),b=N(()=>{const t=V.params.id;return t?t.replace(/^["']|["']$/g,"").trim():""}),f=N(()=>!a.value.articles||a.value.articles.length===0?[]:a.value.articles.map(t=>{let e=t.id||t.article_id||"",o=typeof e=="string"?e.replace(/^["']|["']$/g,"").trim():"";return{...t,cleanId:o}}).filter(t=>t.cleanId)),C=X.create({baseURL:"http://localhost:3000/api",timeout:5e3,headers:{"Content-Type":"application/json"}}),x=async()=>{w.value=!0,I.value=!1;try{const t=b.value;if(!t)throw new Error("无效的食谱ID");const e=await C.get(`/recipes/${t}`);if(e.status!==200)throw new Error(`请求失败，状态码: ${e.status}`);a.value=e.data,a.value.recipe_id&&await L(a.value.recipe_id)}catch(t){console.error("获取食谱详情失败:",t),I.value=!0}finally{w.value=!1}},L=async t=>{E.value=!0;try{const e=t.replace(/^["']|["']$/g,"").trim();if(!e)throw new Error("无效的食谱ID");const o=await C.get(`/articles/recipe/${e}`);if(o.status!==200)throw new Error(`获取文章失败，状态码: ${o.status}`);const R=o.data||[],p=[];for(const r of R){const _=r.id||r.article_id;if(_)try{const i=(await C.get(`/article-photos/article/${_}`)).data[0].image_url;p.push({id:_,title:r.title||"无标题",summary:r.summary||"",created_at:r.created_at||"",imageUrl:i||"/assets/default-article-cover.png"})}catch{p.push({id:_,title:r.title||"无标题",summary:r.summary||"",created_at:r.created_at||"",imageUrl:"/assets/default-article-cover.png"})}}a.value.articles=p,f.value.length===0&&y.info("该食谱暂无有效关联文章")}catch(e){console.error("获取食谱文章失败:",e),a.value.articles=[]}finally{E.value=!1}};G(()=>{b.value?x():(I.value=!0,w.value=!1,y.error("未找到食谱ID"))});const M=t=>({draft:"草稿",published:"已发布",archived:"已归档"})[t]||"未知",B=t=>t?new Date(t).toLocaleString():"",U=()=>{k.push("/cookbooks")},A=()=>{const t=a.value.recipe_id?a.value.recipe_id.replace(/^["']|["']$/g,"").trim():"";t?k.push({name:"EditCookbooks",params:{id:t}}).catch(e=>{console.error("编辑页面跳转失败:",e)}):y.error("无法编辑，食谱ID无效")},T=()=>{k.push("/new_article")},j=t=>{if(!t){console.error("文章ID不存在或无效"),y.error("文章ID无效，无法查看详情");return}const e=a.value.recipe_id?a.value.recipe_id.replace(/^["']|["']$/g,"").trim():"";if(!e){console.error("食谱ID不存在或无效"),y.error("获取食谱信息失败，无法查看文章");return}k.push({path:`/article/${t}`,query:{recipeId:e,recipeName:a.value.recipe_name||""}})};return(t,e)=>{const o=v("el-button"),R=v("el-skeleton"),p=v("el-empty"),r=v("el-image"),_=v("el-tag"),h=v("el-card");return l(),$("div",Y,[s("div",Z,[m(o,{type:"primary",icon:D(O),size:"small",onClick:U},{default:c(()=>e[0]||(e[0]=[n(" 返回列表 ")])),_:1,__:[0]},8,["icon"]),s("h2",ee,u(a.value.recipe_name),1),s("div",te,[m(o,{type:"warning",icon:D(P),size:"small",onClick:T},{default:c(()=>e[1]||(e[1]=[n(" 新文章 ")])),_:1,__:[1]},8,["icon"]),a.value.recipe_id?(l(),d(o,{key:0,type:"success",icon:D(H),size:"small",onClick:A},{default:c(()=>e[2]||(e[2]=[n(" 编辑 ")])),_:1,__:[2]},8,["icon"])):z("",!0)])]),w.value?(l(),d(R,{key:0,rows:8,style:{width:"100%"}})):I.value?(l(),d(p,{key:1,description:"获取食谱数据失败，请稍后重试"},{default:c(()=>[m(o,{type:"primary",onClick:x},{default:c(()=>e[3]||(e[3]=[n("重新加载")])),_:1,__:[3]})]),_:1})):(l(),d(h,{key:2,class:"recipe-detail-card"},{default:c(()=>[s("div",ae,[m(r,{src:a.value.cover_image_url,alt:a.value.recipe_name,class:"recipe-cover",fit:"cover"},null,8,["src","alt"]),s("div",se,[s("div",re,[m(_,{class:J(`custom-tag status-tag-${a.value.status}`),size:"small"},{default:c(()=>[n(u(M(a.value.status)),1)]),_:1},8,["class"])]),s("div",oe,[s("p",null,[e[4]||(e[4]=s("span",{class:"label"},"创建时间：",-1)),n(u(B(a.value.created_at)),1)]),f.value.length?(l(),$("p",le,[e[5]||(e[5]=s("span",{class:"label"},"包含文章数：",-1)),n(u(f.value.length)+"篇 ",1)])):z("",!0)])])]),s("div",ie,[e[6]||(e[6]=s("h2",null,"简介",-1)),s("p",null,u(a.value.description),1)])]),_:1})),f.value.length?(l(),d(h,{key:3,class:"footer-article-card"},{default:c(()=>[e[8]||(e[8]=s("h3",{class:"article-title"},"本食谱包含的文章",-1)),s("div",ce,[(l(!0),$(K,null,Q(f.value,i=>(l(),d(h,{class:"article-item-card",key:i.cleanId,onClick:fe=>j(i.cleanId)},{default:c(()=>[s("div",ne,[m(r,{src:i.imageUrl,alt:i.title,class:"article-image",fit:"cover"},null,8,["src","alt"]),s("div",ue,[s("h4",de,u(i.title),1),s("p",pe,[e[7]||(e[7]=s("i",{class:"el-icon-calendar"},null,-1)),n(" "+u(B(i.created_at)),1)]),s("p",_e,u(i.summary||"无摘要信息"),1)])])]),_:2},1032,["onClick"]))),128))])]),_:1,__:[8]})):(l(),d(p,{key:4,description:"本食谱暂未包含任何文章",class:"no-articles-empty"}))])}}}),ke=W(me,[["__scopeId","data-v-5e757c29"]]);export{ke as default};
