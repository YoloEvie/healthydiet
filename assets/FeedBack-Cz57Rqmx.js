import{a as A}from"./axios-NIGUFBhG.js";import{_ as R,u as S}from"./index-bPO5O26h.js";import{r as m,b as V,v as Z,k as a,e as $,o as f,g as t,j as o,f as b,l as _,y as x,x as B,H as g}from"./element-plus-BAXMo5c4.js";const E={class:"feedback-container"},M={__name:"FeedBack",setup(j){const k=S(),r=m(null),u=m(!1),d=m(!1),w=m(""),l=V({type:"",content:"",contact:"",user_id:""}),C=V({type:[{required:!0,message:"请选择反馈类型",trigger:"change"}],content:[{required:!0,message:"请输入反馈内容",trigger:"blur"},{min:5,message:"反馈内容至少需要5个字符",trigger:"blur"}],contact:[{pattern:/^1[3-9]\d{9}$|^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"请输入有效的手机号或邮箱",trigger:"blur"}]}),F=()=>{const n=localStorage.getItem("user_id");return n?n.replace(/^"/,"").replace(/"$/,""):null},I=async()=>{const n=F();if(console.log("提交的反馈类型:",l.type),console.log("提交的完整数据:",{type:l.type,content:l.content,contact:l.contact,user_id:n||null}),!!r.value)try{if(await r.value.validate(),!d.value){g.warning("请同意将反馈用于产品改进");return}u.value=!0,(await A.post("http://localhost:3000/api/feedbacks",{...l,user_id:n||null})).data&&(g.success("反馈提交成功，感谢您的支持！"),v(),k.push("/mine"))}catch(e){console.error("提交反馈失败:",e),g.error(e.response?.data?.message||"提交失败，请稍后再试")}finally{u.value=!1}},v=()=>{r.value&&r.value.resetFields(),d.value=!1,l.user_id=w.value},U=()=>{k.back()};return Z(()=>{}),(n,e)=>{const p=a("el-option"),N=a("el-select"),c=a("el-form-item"),y=a("el-input"),h=a("el-checkbox"),i=a("el-button"),q=a("el-form"),z=a("el-card");return f(),$("div",E,[t(z,{class:"feedback-card"},{default:o(()=>[e[8]||(e[8]=b("div",{slot:"header",class:"feedback-header"},[b("h2",null,"用户反馈"),b("p",{class:"feedback-desc"},"请告诉我们您的使用体验或建议，帮助我们改进")],-1)),t(q,{ref_key:"feedbackForm",ref:r,model:l,rules:C,"label-width":"100px",class:"feedback-form"},{default:o(()=>[t(c,{label:"反馈类型",prop:"type"},{default:o(()=>[t(N,{modelValue:l.type,"onUpdate:modelValue":e[0]||(e[0]=s=>l.type=s),placeholder:"请选择反馈类型",clearable:""},{default:o(()=>[t(p,{label:"漏洞报告",value:"bug_report"}),t(p,{label:"功能请求",value:"feature_request"}),t(p,{label:"用户体验",value:"user_experience"}),t(p,{label:"其他",value:"other"})]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"反馈内容",prop:"content"},{default:o(()=>[t(y,{modelValue:l.content,"onUpdate:modelValue":e[1]||(e[1]=s=>l.content=s),type:"textarea",rows:6,placeholder:"请详细描述您遇到的问题或建议..."},null,8,["modelValue"])]),_:1}),t(c,{label:"联系方式",prop:"contact"},{default:o(()=>[t(y,{modelValue:l.contact,"onUpdate:modelValue":e[2]||(e[2]=s=>l.contact=s),placeholder:"请输入手机号或邮箱（选填，方便我们跟进）"},null,8,["modelValue"])]),_:1}),t(c,null,{default:o(()=>[t(h,{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value=s),class:"agreement-checkbox"},{default:o(()=>e[4]||(e[4]=[_(" 我同意将此反馈用于产品改进 ")])),_:1,__:[4]},8,["modelValue"])]),_:1}),t(c,{class:"form-actions"},{default:o(()=>[t(i,{type:"primary",onClick:I,loading:u.value},{default:o(()=>e[5]||(e[5]=[_(" 提交反馈 ")])),_:1,__:[5]},8,["loading"]),u.value?B("",!0):(f(),x(i,{key:0,onClick:v},{default:o(()=>e[6]||(e[6]=[_(" 重置 ")])),_:1,__:[6]})),u.value?B("",!0):(f(),x(i,{key:1,onClick:U},{default:o(()=>e[7]||(e[7]=[_(" 返回 ")])),_:1,__:[7]}))]),_:1})]),_:1},8,["model","rules"])]),_:1,__:[8]})])}}},G=R(M,[["__scopeId","data-v-da51c0ac"]]);export{G as default};
