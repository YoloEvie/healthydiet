import{A as L}from"./ArticleCard-BGw7Nb_A.js";import{a as c}from"./axios-NIGUFBhG.js";import{_ as N,u as V}from"./index-DAIr6xV4.js";import{r as l,c as M,t as T,k as i,e as g,o as s,f,x as m,v as p,g as U,j as F,l as P,F as R,z as j}from"./element-plus-DirRqt2a.js";const q={class:"my-articles"},z={id:"header"},E={key:2,class:"article-flex"},O={__name:"MyLike",setup(S){const h=V();c.defaults.baseURL="http://localhost:3000";const n=l(""),_=l([]),u=l({}),r=l(!0),o=l(""),v=l(null),y=async()=>{try{const e=await c.get(`/api/users/${n.value}`);v.value=e.data,console.log("当前用户信息:",e.data)}catch(e){console.error("获取当前用户信息失败:",e)}},d=M(()=>_.value.filter(e=>e.type==="Ordinary")),k=async e=>{try{const t=await c.get(`/api/article-photos/article/${e}`);return t.data&&t.data.length>0?(u.value[e]=t.data[0].image_url,console.log(`文章 ${e} 照片:`,t.data[0].image_url),t.data[0].image_url):(u.value[e]=null,console.log(`文章 ${e} 没有照片`),null)}catch(t){return console.error(`获取文章 ${e} 照片失败:`,t),u.value[e]=null,null}},x=async()=>{try{r.value=!0,console.log("userId:",n.value);const e=await c.get(`/api/user-likes/user/${n.value}`);_.value=e.data;for(const t of _.value)await k(t.article_id)}catch(e){e.response?o.value=e.response.data.message||`错误 ${e.response.status}: 获取点赞文章失败`:e.request?o.value="无法连接到服务器，请检查后端服务是否运行":o.value="发生未知错误，请重试",console.error("获取用户点赞文章错误:",e)}finally{r.value=!1}},$=e=>{console.log("查看文章详情:",e),h.push(`/forum/article/${e}`)},C=()=>{h.back()};return T(()=>{const e=localStorage.getItem("user_id");if(console.log("userIdText:",e),!e){o.value="未找到用户信息，请先登录",r.value=!1;return}n.value=e.replace(/^["']|["']$/g,""),x(),y()}),(e,t)=>{const w=i("el-button"),A=i("el-skeleton"),b=i("el-alert"),B=i("el-empty");return s(),g("div",q,[f("div",z,[U(w,{type:"primary",onClick:C},{default:F(()=>t[0]||(t[0]=[P(" 返回 ")])),_:1,__:[0]}),t[1]||(t[1]=f("h2",null,"我喜欢的文章",-1))]),r.value?(s(),m(A,{key:0,class:"article-skeleton",count:3})):p("",!0),o.value?(s(),m(b,{key:1,type:"error",message:o.value,"show-icon":""},null,8,["message"])):p("",!0),d.value.length>0&&!r.value?(s(),g("div",E,[(s(!0),g(R,null,j(d.value,a=>(s(),m(L,{class:"article-card",key:a.article_id,"image-url":u.value[a.article_id]||"https://picsum.photos/400/200",title:a.title,excerpt:a.summary,"author-name":v.value.username||"未知用户","author-avatar":v.value.avatar_url||"https://picsum.photos/100/100",category:a.type,likes:a.likes_count,comments:a.comments_count,onClick:D=>$(a.article_id)},null,8,["image-url","title","excerpt","author-name","author-avatar","category","likes","comments","onClick"]))),128))])):p("",!0),d.value.length===0&&!r.value&&!o.value?(s(),m(B,{key:3,description:"暂无点赞的文章"})):p("",!0)])}}},Q=N(O,[["__scopeId","data-v-4057b050"]]);export{Q as default};
