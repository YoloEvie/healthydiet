import{d as R,r,w as L,t as N,e as S,g as l,f as b,j as d,k as v,u as T,O as j,l as k,G as t,o as z,M as D}from"./element-plus-DirRqt2a.js";import{a as f}from"./axios-NIGUFBhG.js";import{a as G,u as H,_ as O}from"./index-CMQRH6kX.js";const q={class:"main"},J=["src"],K={class:"button-area"},i="http://localhost:3000",Q=R({__name:"EditArticlePhotos",props:{id:{}},setup(C){const c=C;console.log("接收的参数:",c);const I=G(),g=H(),a=r([]),h=r(""),_=r(!1),p=r(!1),w=r(`${i}/api/article-photos/article/${c.id}`),n=r({Authorization:`Bearer ${localStorage.getItem("token")||""}`}),u=async()=>{const e=c.id||I.params.id;if(!e){console.error("articleId 未定义"),t.error("文章ID不存在，无法加载图片");return}try{const o=await f.get(`${i}/api/article-photos/article/${e}`,{headers:n.value});a.value=o.data.map(s=>({id:s.photo_id,name:s.image_url.split("/").pop()||"image",url:s.image_url,sort_order:s.sort_order,is_cover:s.is_cover}))}catch(o){console.error("获取文章图片失败:",o),t.error("获取图片失败，请重试")}};L(()=>c.id,e=>{e&&(w.value=`${i}/api/article-photos/article/${e}`,u())}),N(()=>{u()});const x=e=>D.confirm("确定要删除这张图片吗？").then(()=>!0,()=>!1),P=async e=>{if(e.id)try{if(await f.delete(`${i}/api/article-photos/${e.id}`,{headers:n.value}),t.success("图片删除成功"),e.is_cover&&a.value.length>0){const o=a.value[0].id;o&&await y(o)}}catch(o){console.error("图片删除失败:",o),t.error("删除失败，请重试"),u()}},V=e=>{h.value=e.url,_.value=!0},y=async e=>{try{await f.put(`${i}/api/article-photos/article/${c.id}/cover/${e}`,{},{headers:n.value}),t.success("封面设置成功"),await u()}catch(o){console.error("设置封面失败:",o),t.error("设置封面失败，请重试")}},B=async()=>{if(t.success("图片上传成功"),await u(),a.value.length===1){const e=a.value[0].id;e&&await y(e)}},U=async()=>{p.value=!0;try{for(let e=0;e<a.value.length;e++){const o=a.value[e];o.id&&await f.put(`${i}/api/article-photos/${o.id}`,{sort_order:e},{headers:n.value})}t.success("保存成功"),g.back()}catch(e){console.error("保存失败:",e),t.error("保存失败，请重试")}finally{p.value=!1}},A=()=>{g.back()};return(e,o)=>{const s=v("el-icon"),E=v("el-upload"),M=v("el-dialog"),$=v("el-button");return z(),S("div",q,[l(E,{"file-list":a.value,"onUpdate:fileList":o[0]||(o[0]=m=>a.value=m),action:w.value,"list-type":"picture-card","on-preview":V,"on-remove":P,"on-success":B,headers:n.value,"before-remove":x,name:"image"},{default:d(()=>[l(s,null,{default:d(()=>[l(T(j))]),_:1})]),_:1},8,["file-list","action","headers"]),l(M,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=m=>_.value=m)},{default:d(()=>[b("img",{"w-full":"",src:h.value,alt:"Preview Image"},null,8,J)]),_:1},8,["modelValue"]),b("div",K,[l($,{type:"primary",onClick:U,loading:p.value,class:"mt-4"},{default:d(()=>o[2]||(o[2]=[k(" 保存图片 ")])),_:1,__:[2]},8,["loading"]),l($,{type:"success",onClick:A,loading:p.value,class:"mt-4"},{default:d(()=>o[3]||(o[3]=[k(" 返回 ")])),_:1,__:[3]},8,["loading"])])])}}}),Z=O(Q,[["__scopeId","data-v-de8018b1"]]);export{Z as default};
