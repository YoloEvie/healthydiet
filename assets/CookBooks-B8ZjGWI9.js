import{d as L,r as f,k as c,x as m,o as u,j as i,f as n,g as a,u as b,A,B as G,l as _,y as V,C as x,D as H,E as J,c as K,t as O,G as U,w as Q,H as P,e as I,I as W,J as X,K as Y,v as Z,F as ee,z as te}from"./element-plus-DirRqt2a.js";import{u as N,_ as j,a as se}from"./index-DAIr6xV4.js";const oe={class:"work-cover-container"},ae={class:"image-error"},re={class:"work-info"},ne={class:"work-title"},le={class:"work-description"},ie={class:"work-actions"},ue=L({__name:"RecipeItem",props:{work:{}},emits:["view","edit"],setup(T,{emit:k}){const l=T,o=f(!1),h=N(),w=t=>({draft:"草稿",published:"已发布",archived:"已归档"})[t]||"未知",d=t=>({draft:"info",published:"success",archived:"danger"})[t]||"info",y=t=>`status-${t}`,E=()=>{h.push({name:"ViewCookbooks",params:{id:l.work.id}}).catch(t=>{console.error("查看页面跳转失败:",t)})},v=()=>{h.push({name:"EditCookbooks",params:{id:l.work.id}}).catch(t=>{console.error("编辑页面跳转失败:",t)})};return(t,r)=>{const p=c("el-icon"),M=c("el-image"),g=c("el-tag"),C=c("el-button"),q=c("el-card");return u(),m(q,{class:"work-item-card",shadow:o.value?"hover":"always",onMouseenter:r[0]||(r[0]=B=>o.value=!0),onMouseleave:r[1]||(r[1]=B=>o.value=!1)},{default:i(()=>[n("div",oe,[a(M,{src:t.work.coverUrl,alt:t.work.title,class:"work-cover",fit:"cover","preview-teleported":"","preview-src-list":[t.work.coverUrl]},{error:i(()=>[n("div",ae,[a(p,null,{default:i(()=>[a(b(A))]),_:1})])]),_:1},8,["src","alt","preview-src-list"]),a(g,{class:G(`status-tag ${y(t.work.status)}`),type:d(t.work.status),size:"small",style:{color:"#fafafa"}},{default:i(()=>[_(V(w(t.work.status)),1)]),_:1},8,["class","type"])]),n("div",re,[n("h3",ne,V(t.work.title),1),n("p",le,V(t.work.description),1),n("div",ie,[a(C,{size:"small",type:"primary",onClick:x(E,["stop"])},{default:i(()=>[a(p,null,{default:i(()=>[a(b(H))]),_:1}),r[2]||(r[2]=_(" 查看 "))]),_:1,__:[2]}),a(C,{size:"small",type:"success",onClick:x(v,["stop"])},{default:i(()=>[a(p,null,{default:i(()=>[a(b(J))]),_:1}),r[3]||(r[3]=_(" 编辑 "))]),_:1,__:[3]})])])]),_:1},8,["shadow"])}}}),ce=j(ue,[["__scopeId","data-v-0bafca79"]]),de={class:"main"},pe={id:"header"},_e={class:"add-container"},ve={class:"search-container"},fe={key:4,class:"recipe-list"},me={key:0,class:"search-result"},ke={class:"search-text"},he={class:"count"},we=L({__name:"CookBooks",setup(T){const k=N(),l=se(),o=f(""),h=f(!0),w=f(!1);let d=null;const y=K(()=>o.value.trim().length>0),E=e=>e&&["draft","published","archived"].includes(e)?e:"draft",v=f([]),t=f([]);O(async()=>{l.query.keyword&&typeof l.query.keyword=="string"&&(o.value=l.query.keyword);try{const e=localStorage.getItem("user_id");if(!e)throw new Error("未找到用户信息，请先登录");const s=e.replace(/^["']|["']$/g,""),$=await fetch(`http://localhost:3000/api/recipes/user/${s}`);if(!$.ok)throw new Error("获取食谱失败");const R=await $.json();v.value=R,p(),w.value=!1}catch(e){console.error("数据加载失败:",e),w.value=!0,U.error(e instanceof Error?e.message:"加载数据时发生错误")}finally{h.value=!1}}),Q(()=>l.query.keyword,e=>{typeof e=="string"?(o.value=e,p()):e===void 0&&(o.value="",p())});const r=e=>({id:String(e.recipe_id),title:e.recipe_name,coverUrl:e.cover_image_url,description:e.description,status:E(e.status)}),p=()=>{const e=o.value.trim().toLowerCase();if(!e){t.value=v.value;return}t.value=v.value.filter(s=>s.recipe_name.toLowerCase().includes(e)||s.description.toLowerCase().includes(e))},M=()=>{d&&clearTimeout(d),d=window.setTimeout(()=>{g()},300)},g=()=>{const e=o.value.trim();k.push({path:l.path,query:{...l.query,keyword:e||void 0}})},C=()=>{o.value="";const{keyword:e,...s}=l.query;k.push({path:l.path,query:Object.keys(s).length?s:void 0}),t.value=v.value,U.success("已清除搜索条件")};P(()=>{d&&clearTimeout(d)});const q=e=>{k.push(`/recipes/${e}`)},B=e=>{k.push(`/recipes/edit/${e}`)};return(e,s)=>{const $=c("el-button"),R=c("router-link"),F=c("el-input"),D=c("el-skeleton"),z=c("el-empty");return u(),I("div",de,[n("header",pe,[n("div",_e,[a(R,{to:"/cookbooks/add"},{default:i(()=>[a($,{type:"primary"},{default:i(()=>s[2]||(s[2]=[_("添加")])),_:1,__:[2]})]),_:1})]),n("div",ve,[a(F,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=S=>o.value=S),style:{width:"240px"},placeholder:"搜索食谱","suffix-icon":o.value?b(X):b(Y),"onClick:suffix":s[1]||(s[1]=S=>o.value?C:g),onInput:M,onKeyup:W(g,["enter"])},null,8,["modelValue","suffix-icon"])])]),n("main",null,[h.value?(u(),m(D,{key:0,rows:6,style:{width:"100%"}})):w.value?(u(),m(z,{key:1,description:"获取数据失败，请稍后重试"})):t.value.length===0&&!y.value?(u(),m(z,{key:2,description:"暂无食谱数据"})):t.value.length===0&&y.value?(u(),m(z,{key:3,description:"未找到匹配的食谱"})):(u(),I("div",fe,[y.value?(u(),I("div",me,[n("div",ke,[s[3]||(s[3]=_(" 搜索到 ")),n("span",he,V(t.value.length),1),_(' 条关于 "'+V(o.value)+'" 的结果 ',1)]),a($,{type:"success",size:"small",onClick:C},{default:i(()=>s[4]||(s[4]=[_(" 清除搜索 ")])),_:1,__:[4]})])):Z("",!0),(u(!0),I(ee,null,te(t.value,S=>(u(),m(ce,{key:S.recipe_id,work:r(S),onView:q,onEdit:B},null,8,["work"]))),128))]))])])}}}),Ce=j(we,[["__scopeId","data-v-ff50de33"]]);export{Ce as default};
